<!DOCTYPE html>
<html>

<head>
  <title>AVAR</title>
  <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
        "imports": {
          "three": "https://unpkg.com/three@0.147.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.147.0/examples/jsm/",
          "mindar-face-three": "https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-face-three.prod.js"
        }
      }
    </script>
  <script type="module">
    import * as THREE from 'three'
      import { GLTFLoader } from 'three/addons/loaders/GLTFLoader'
      import { RGBELoader } from 'three/addons/loaders/RGBELoader.js'
      import { MindARThree } from 'mindar-face-three'
      const mindarThree = new MindARThree({
        container: document.querySelector('#container'),
      })
      const { renderer, scene, camera } = mindarThree
      const anchor = mindarThree.addAnchor(1)
      const loader = new GLTFLoader()
      let i = 1
      new RGBELoader().load('./assets/hdr.hdr', function (texture) {
        texture.mapping = THREE.EquirectangularReflectionMapping

        // scene.background = texture;
        scene.environment = texture
      })
      loader.load('./assets/headwear/head.glb', (gltf) => {
        gltf.scene.position.set(0,0.3,-0.1)
        gltf.scene.traverse((o) => {
          if (o.isMesh) {
            const material = new THREE.MeshStandardMaterial({
              colorWrite: false,
            })
            o.material = material
          }
        })
        anchor.group.add(gltf.scene)
      })
      loader.load('./assets/head/1.glb', (gltf) => {
        gltf.scene.position.set(0, -3.8, -1)
        gltf.scene.scale.set(1.9,1.9,1.9)
        gltf.scene.name = 'headwear'
        anchor.group.add(gltf.scene)
      })
      const start = async () => {
        await mindarThree.start()
        renderer.setAnimationLoop(() => {
          renderer.render(scene, camera)
        })
      }
      const startButton = document.querySelector('#startButton')
      const stopButton = document.querySelector('#stopButton')
      const changeButton = document.querySelector('#changeButton')
      changeButton.addEventListener('click',()=>{
        anchor.group.children.pop();
        if(i==16){
          i = 1
        }else{
          i++;
        }
        loader.load(`./assets/head/${i}.glb`,(gltf) => {
        gltf.scene.position.set(0, -3.8, -1)
        gltf.scene.scale.set(1.9,1.9,1.9)
        gltf.scene.name = 'headwear'
        anchor.group.add(gltf.scene)
      })
      })
      startButton.addEventListener('click', () => {
        start()
      })
      stopButton.addEventListener('click', () => {
        mindarThree.stop()
        mindarThree.renderer.setAnimationLoop(null)
        renderer.render(scene, camera)
      })
    </script>
  <style>
    body {
      margin: 0;
    }

    #container {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    #control {
      width: 100vw;
      display: flex;
      justify-content: space-around;
      position: fixed;
      top: 50px;
      left: 0;
      z-index: 2;
    }

    button {
      width: 30vw;
      height: 50px;
      border-radius: 10px;
    }
  </style>
</head>

<body>
  <div id="control">
    <button id="startButton">Start</button>
    <button id="changeButton">Change</button>
    <button id="stopButton">Stop</button>
  </div>
  <div id="container"></div>
</body>

</html>